<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Norm Compliance Tree Test</title>
</head>
<body>
  <h1>Compliance Tree (MVP Test)</h1>
  <div id="tree"></div>
  <script>
    // Fetch and render the tree
    async function fetchTree() {
      const res = await fetch('http://localhost:8001/');
      if (!res.ok) {
        document.getElementById('tree').innerText = 'Failed to fetch tree.';
        return;
      }
      const data = await res.json();
      renderTree(data, document.getElementById('tree'));
    }

    // Render the tree recursively
    function renderTree(node, container) {
      const nodeDiv = document.createElement('div');
      nodeDiv.style.marginLeft = '20px';
      nodeDiv.innerHTML = `<b>${node.type}</b> (id: ${node.id}): ${node.name} | Status: <span id="status-${node.id}">${node.status ?? 'N/A'}</span>`;
      // Add override button for each node
      if (node.status) {
        const btn = document.createElement('button');
        btn.innerText = node.status === 'PASS' ? 'Set FAIL' : 'Set PASS';
        btn.onclick = async () => {
          btn.disabled = true;
          await overrideStatus(node.id, node.status === 'PASS' ? 'FAIL' : 'PASS');
          await fetchTree();
        };
        nodeDiv.appendChild(btn);
      }
      container.appendChild(nodeDiv);
      // Render children
      if (node.children && node.children.length > 0) {
        node.children.forEach(child => renderTree(child, nodeDiv));
      }
    }

    // Call override endpoint
    async function overrideStatus(nodeId, newStatus) {
      await fetch(`http://localhost:8001/override/${nodeId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ status: newStatus })
      });
    }

    fetchTree();
  </script>
</body>
</html> 